---
title: "RE4B: CH_1.3.md"
date: 2025-10-02
categories: [Reverse, Books]
tags: [Reverse, RE4B, Basics]
image: /assets/img/posts/ch1/C.jpeg
---

<h1>1.3 An Empty Function</h1>
<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(148,163,184,.18);
  background:rgba(148,163,184,.05);
  line-height:1.9;
  color:#E5E7EB;">
  <ul style="margin:0; padding-right:18px;">
    <li>
      عندنا دالة فاضية مش بتعمل أي حاجة حرفيا
    </li>
    <li>
      مش بتستقبل قيم ولا بترجع قيم ولا بتنفذ أي عمليات
    </li>
    <li>
      كل اللي عليها تعمله انها تِرْجع بس 
    </li>
    
  </ul>
</div>

<div dir="rtl">
  <h2>مثال</h2>
</div>

```c
void f()
{
	return;
};
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(96,165,250,.22);
  background:rgba(96,165,250,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <ul style="margin:0; padding-right:18px;">
    <li>
      هنعملها compile ونشوف الـAssembly لكل ISA
    </li>
    <li>
      هنشوف إزاي بيتم "الرجوع" في كل معمارية
    </li>
  </ul>
</div>

<div dir="rtl" >
  <h2>هنبدأ X86:</h2>
</div>

```asm
f:
	ret
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(96,165,250,.22);
  background:rgba(96,165,250,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h3>عنوان الرجوع محفوظ في الـStack </h3>
  <ul style="margin:0; padding-right:18px;">
    <li>طيب RET بتعمل إيه ؟</li>
    <li>-بتسحب العنوان</li>
    <li>-تقفز إليه</li>
    <li>يعني بتعمل أبسط سيناريو ممكن </li>
  </ul>
</div>

<div dir="rtl">
  <h2>نروح لـ ARM</h2>
  <h3>دا كود الـAssembly كامل</h3>
</div>

```asm
f
PROC
    BX      lr
ENDP
```
<div dir="rtl">
  <h3>بس اللي محتاجينه منه الجزء دا بس</h3>
</div>

```asm
BX LR
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(96,165,250,.22);
  background:rgba(96,165,250,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h3>عنوان الرجوع محفوظ في الـStack </h3>
  <ul style="margin:0; padding-right:18px;">
    <li>معالج ARM مش بيخزن عنوان الرجوع في الـStack تلقائيا</li>
    <li>بيخزنه في سجل اسمه: LR (Link Register)</li>
    <li>فبالتالي أمر BX LR يعني:</li>
    <li>- اقفز للعنوان الموجود في LR </li>
    <li>- يعني "إرجع" = return اللي كانت في كود الـ C</li>
  </ul>
  <h3>خلي بالك ARM = الرجوع من الـRegister مش من الStack</h3>
</div>

<div dir="rtl">
  <h2>نروح للـMIPS</h2>
  <h3>وفيه نوعين لتسمية السجلات </h3>
  <h3>التسمية بالحروف بيعرضها برنامج IDA:</h3>
  <h3>هنشوفه قدام</h3>
</div>

```asm
j   $31
nop
```

<div dir="rtl">
  <h3>التسمية بالأرقام بيعرضها برنامج GCC:</h3>
  <h3>هنشوفه قدام هو كمان</h3>
</div>

```asm
j    $ra
nop
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(96,165,250,.22);
  background:rgba(96,165,250,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <ul style="margin:0; padding-right:18px;">
  <li>عنوان الرجوع محفوظ في: ra = return address</li>
  <li>نفس فكرة LR في ARM</li>
  <li>الـ j / jr تقفز لعنوان الرجوع</li>
  <li>الـ nop معناها في العموم No Operation يعني متعملش حاجة </li>
  </ul>
</div>

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(245,158,11,.22);
  background:rgba(245,158,11,.08);
  line-height:1.9;
  color:#E5E7EB;">
  <h2>سؤال مهم:</h2>
  <h3>ليه الدالة طلعت بتعليمة واحدة</h3>
  <ul style="margin:0; padding-right:18px;">
    <li>السبب:</li>
    <li>- مفيش متغيرات</li>
    <li>- مفيش حسابات</li>
    <li>- مفيش Stack frame</li>
    <li>- مفيش return value</li>
  </ul>
  <h3>فـالـcompiler لقي أقصر طريق لتعريفها = "ارجع حالا"</h3>
</div>

<div dir="rtl">
  <h2>الملخص</h2>
  <h3>لو شوفت تعليمات بالشكل دا</h3>
</div>

```asm
ret
BX lr
j $ra
``` 

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h2>فـده غالبا:</h2>
  <ul style="margin:0; padding-right:18px;">
    <li>- دالة فاضية</li>
    <li>- أو كود اتحذف بسبب optimization</li>
    <li>فمتستصغرهاش بس افهم السياق</li>
  </ul>
</div>

<div dir="rtl">
  <h2>دا ملخص علي السريع للفرق بين الـISA</h2>
</div>
![mola5as](/assets/img/posts/ch1/mola.png)

<div dir="rtl">
<h2>كوباية شاي وتعالي نكمل</h2>
</div>
![shay](/assets/img/posts/ch1/shay.jpeg)

<div dir="rtl">
  <h3>نروح لجزئية فيها لغبطة شوية</h3>
  <h2>1.3.4 Empty Functions in Practice</h2>
</div>


<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <ul style="margin:0; padding-right:18px;">
    <li>هنتكلم دلوقتي عن الدالة الفارغة... أعتقد انتم ذاكرتوها في الكورس علي الأقل</li>
    <li>فهنعملها مراجعة بسيطة ونشوف شوية معلومات عنها</li>
    <li>- أولا بنستخدمها كتير في الـDebugging</li>
    <li>- مثال: لو احنا بنعمل برنامج جديد فطول ما احنا في وضع التطوير </li>
    <li>  عايزين نشوف هل البرنامج ماشي تمام ولا فيه مشاكل؟</li>
    <li>  فبنعمل كدة عن طريق اظهار الـLogs</li>
    
  </ul>
</div>

## Easy Example

<div dir="rtl">
 <h2>- الكومنات اعتبروها أكواد لتنفيذ المكتوب بما انه مثال</h2> 
</div>

```c
void dbg_print (const char *fmt, ...)
{
#ifdef _DEBUG
    // open logs file
    // write in logs file
    // close logs file
#endif
};
```

<div dir="rtl">
 <h2>-استدعاء الدالة واستخدامها</h2> 
</div>

```c
void some_function()
{
    ...
    dbg_print("we did something\n");
    ...
};
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h2>شرح المثال:</h2>
  <ul style="margin:0; padding-right:18px;">
    <li>واحنا لسة بنطور في البرنامج عايزين نعرف شوية دوال هلي هي شغالة 
	صح ولا لا </li>
    <li>فلو هي شغالة صح هتعمل طباعة للي جواها</li>
    <li>لو مش شغالة هتطبع الخطأ دا في ملف الـlog زي ما احنا عاملين</li>
    <li>- فـ دا مثال علي استخدام الدوال الفارغة</li>
    <li>- طيب عشان نبسط الموضوع أكتر لو مش واضح </li>
    <li>	- الدالة دي انت مش بتكتب جواها return </li>
    <li>	- يعني هي مش بتستدعي نفسها </li>
    <li>	- انت بتستدعيها بداخل دالة أخري لما تحتاجها </li>
    <li>	- تستدعيها لوحدها المهم انها مش بترجع حاجة غير لما انت تستدعيها </li>
  </ul>
</div>

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h2>نكمل بقية الشرح</h2>
  <ul style="margin:0; padding-right:18px;">
    <li>- بما اننا كنا في نسخة من البرنامج تحت التطوير </li>
    <li>- فـكان فيه الـDebug </li>
    <li>- في نسخة العملاء بيبقي فيه طريقتين يا اما نلغي استدعاء الدوال</li>
    <li>	يا اما بنعمل كومنت للكود بتاعها وبنسيب استدعائها في مكانه عشان لو حبينا نشغلها تاني</li>
  </ul>
</div>

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <h2>مثال علي نسخة Demo تجريبية</h2>
  <h3>لو البرنامج بينشأ ملف ما وبعد كدة بتضغط save عشان تحفظه في النسخة الكاملة</h3>
  <ul style="margin:0; padding-right:18px;">
    <li>لو جينا في النسخة الـDemo</li>
    <li>	- الشخص اللي بيجربها عايزينه ينشأ الملف عادي </li>
    <li>	- بس ميقدرش يحفظه يعني هنلغي كود الحفظ </li>
  </ul>
</div>

```c
void save_file()
{
#ifndef DEMO
    // Real save code 
#endif
};
```

<div dir="rtl" style="
  padding:12px 14px;
  margin:12px 0;
  border-radius:10px;
  border:1px solid rgba(34,197,94,.18);
  background:rgba(34,197,94,.07);
  line-height:1.9;
  color:#E5E7EB;">
  <ul style="margin:0; padding-right:18px;">
    <li>فدلوقتي يقدر يستدعي دالة save_file لما يضغط علي save في الملف </li>
    <li>بس في النسخة التجريبية الـDemo فالكود ملغي اصلا </li>
    <li>ولو قدر يكسر البرنامج مش هيعرف يحفظ عشان الدالة فارغة</li>
    <li></li>
  </ul>
  <ul style="margin:0; padding-right:18px;">
    <li>وعندنا أداة اسمها IDA هنتكلم عنها في الأقسام الجاية </li>
    <li>لما بتعلم reverse وتشوف الinstructions هتلاقي IDA بتضع علامات علي الدوال دي </li>
    <li>بأسماء زي nullsub_00, nullsub_01 وهكذا </li>
  </ul>
</div>








